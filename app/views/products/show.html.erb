<section class="section">
  <div class="section_inner">

    <div class= "title">
      <h1>在庫詳細</h1>
    </div>

    <% flash.each do |key, value| %>
      <%= content_tag(:div, value, class: "#{key}") %>
    <% end %>   

    <table class="osare3-table col4t show">
      <tbody>

        <tr>
          <td>商品名</td>
          <td><%= @product.name %></td>
        </tr>

        <tr>
          <td>説明</td>
          <td><%= @product.content %></td>
        </tr>

        <tr>
          <td>在庫数</td>
          <% @order_done = 0 %>
          <% @product.supplies.each do |supply| %>
            <% supply.order_supplies.left_outer_joins(order: :status).where(statuses: {status: 2}).distinct
            .or(supply.order_supplies.left_outer_joins(order: :status).where(statuses: {status: 3}).distinct)
            .or(supply.order_supplies.left_outer_joins(order: :status).where(statuses: {status: 4}).distinct)
            .or(supply.order_supplies.left_outer_joins(order: :status).where(statuses: {status: 5}).distinct).each do |o| %>
              <% @order_done += o.quantity * o.supply.set  %>
            <% end %>
          <% end %>
  
          <td><%= @product.stock.quantity - @order_done %></td>
          </tr>

      <tbody>
    </table>

    <%= link_to '編集', edit_product_path(@product) %> |
    <%= link_to '戻る', products_path %>
  </div>
</section>